
# HAL and drivers, generated by cubemx
add_subdirectory(board)

add_subdirectory(Protobuf)

list(APPEND APP_SOURCE_FILES
  app_main.c
  board.c
  BleBoardHandler/ble_board_handler.c
  BleBoardHandler/ble_board_message_handler.c
  BleBoardHandler/message_parser.c
  Cobs/cobs.c
  Crc/crc.c
  Control/car.c
  Control/car_control.c
  Control/car_interface.c
  Control/car_state.c
  Control/pwm.c
  DistanceSensor/distance_sensor.c
  Device/I2c/i2c_stm32_hal.c
  Device/Serial/serial_stm32_hal.c
  GPS/gps_handler.c
  IMU/ak8963.c
  IMU/imu_handler.c
  IMU/mpu9250.c
  LinearBuffer/linear_buffer.c
  Log/log.c
  Log/usb_log.c
  Observer/observer.c
  RingBuffer/ring_buffer.c
)


list(APPEND APP_INC_FILES
  BleBoardHandler
  Control
  Cobs
  Crc
  Device
  Device/I2c
  Device/Serial
  DistanceSensor/
  GPS
  IMU
  Log
  Observer
  LinearBuffer
  RingBuffer 
)


set(APP_SOURCE_FILES ${APP_SOURCE_FILES})
set(APP_INC_FILES ${APP_INC_FILES})


set(LINKER_SCRIPT "${CMAKE_CURRENT_LIST_DIR}/STM32F407VGTx_FLASH.ld")
set(CMAKE_EXE_LINKER_FLAGS "-T ${LINKER_SCRIPT}")


include_directories(${INC_FILES})

add_compile_definitions(STM32F407xx USE_HAL_DRIVER)
add_executable(${RC_CAR_CONTROL_BOARD_ELF} main.c app_main.c)
target_link_libraries(${RC_CAR_CONTROL_BOARD_ELF} board)
