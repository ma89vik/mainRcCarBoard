
# HAL and drivers, generated by cubemx
add_subdirectory(board)

set(BOOTLOADER_NAME "rc_control_bootloader")

 list(APPEND APP_SOURCE_FILES
    main.c
    bootloader_uart.c
    led.c
 )


 list(APPEND APP_INC_FILES
#   BleBoardHandler
#   Control
#   Cobs
#   Crc
#   Device
#   Device/I2c
#   Device/Serial
#   DistanceSensor/
#   GPS
#   IMU
#   Log
#   Observer
#   LinearBuffer
   app_drivers/uart
   app_drivers/led
   error_def
   RingBuffer 
 )


set(APP_SOURCE_FILES ${APP_SOURCE_FILES})
set(APP_INC_FILES ${APP_INC_FILES})


set(LINKER_SCRIPT "${CMAKE_CURRENT_LIST_DIR}/STM32F407VGTx_FLASH.ld")
set(CMAKE_EXE_LINKER_FLAGS "-T ${LINKER_SCRIPT}")




add_compile_definitions(STM32F407xx USE_HAL_DRIVER)
add_executable(${BOOTLOADER_NAME}.elf ${APP_SOURCE_FILES})
target_link_libraries(${BOOTLOADER_NAME}.elf bootloader_board)
target_include_directories(${BOOTLOADER_NAME}.elf  PUBLIC ${APP_INC_FILES})


add_custom_command(TARGET ${BOOTLOADER_NAME}.elf
    POST_BUILD
    COMMAND ${CMAKE_OBJCOPY} ARGS -O binary ${BOOTLOADER_NAME}.elf ${BOOTLOADER_NAME}.bin)